<!-- Organisaation voimassaolon muokkaus -->
<script type="text/ng-template" id="aliorganisaatio_node.html">
    <div class="row">
        <div class="span6">
            <!-- Käytetään "level" kertaa sama tila kuin ikoni käyttäisi -->
            <span ng-repeat="t in model.getTimes(data.level) track by $index">
                <i class="icon icon-chevron-right" style="visibility: hidden"></i>
            </span>
            <a href="" class="icon" ng-class="{'icon-chevron-right': !data.expanded, 'icon-chevron-down': data.expanded}"
               ng-click="model.expand(data)" ng-hide="model.isLeaf(data)"></a>
            <i class="icon icon-chevron-right" style="visibility: hidden" ng-if="model.isLeaf(data)"></i>
            <input ng-show="model.isModified" ng-change="model.checkboxChanged(data)" type="checkbox" ng-model="data.valittu" ng-disabled="data.readonly"">
            <span style="display: inline-block; vertical-align: top;">{{data.nimi | decodeAmp}}</span>
        </div>
        <div class="span2">
           {{data.tyyppi}}
        </div>
        <div class="span3">
           {{data.tila}}
        </div>
        <div ng-if="model.muokataanAlkupvm" class="span2">
           Alkupvm {{data.alkuPvm| date:'d.M.yyyy'}}<!-- TODO: translateable -->
        </div>
    </div>
    <ol class="unstyled" ng-if="data.expanded">
        <li ng-repeat="data in data.children | orderBy:'nimi'"
            ng-include="'aliorganisaatio_node.html'">
        </li>
    </ol>
</script>

<div class="modal-header">
    <!--<h3>{{'Voimassaolonmuokkaus.title' | i18n}}</h3>-->
    <h3>Muokataan organisaation {{model.organisaationNimi}} voimassaoloa</h3> <!-- TODO: Make translateable -->
</div>

<div class="modal-body" style='max-height: 500px; min-height: 500px; height:100%;'>
    <label ng-show="model.muokataanAlkupvm" class="control-label">
        {{'Organisaationmuokkaus.luontipvm'| i18n}}*
    </label>
    <label ng-hide="model.muokataanAlkupvm" class="control-label">
        {{'Organisaationmuokkaus.lakkautuspvm'| i18n}}*
    </label>
    <input  ng-show="model.muokataanAlkupvm" ng-change="model.voimassaoloChanged()" oph-enter type="text" name="luontipvm" formatteddate datepicker-popup="dd.MM.yyyy" min="'1990-01-01'" max="'2030-12-31'" ng-model="model.alkuPvm"
            close-on-date-selection="true" ie-placeholder placeholder="{{'Organisaationmuokkaus.luontipvm'| i18n}}"
            close-text="{{'Organisaationmuokkaus.sulje'| i18n}}"
            current-text="{{'Organisaationmuokkaus.tanaan'| i18n}}"
            clear-text="{{'Organisaationmuokkaus.tyhjenna'| i18n}}"
            toggle-weeks-text="{{'Organisaationmuokkaus.viikkonumerot'| i18n}}" required/>
    <input  ng-hide="model.muokataanAlkupvm" ng-change="model.voimassaoloChanged()" oph-enter type="text" name="lakkautuspvm" formatteddate datepicker-popup="dd.MM.yyyy" min="'1990-01-01'" max="'2030-12-31'" ng-model="model.lakkautusPvm"
            close-on-date-selection="true" ie-placeholder placeholder="{{'Organisaationmuokkaus.lakkautuspvm'| i18n}}"
            close-text="{{'Organisaationmuokkaus.sulje'| i18n}}"
            current-text="{{'Organisaationmuokkaus.tanaan'| i18n}}"
            clear-text="{{'Organisaationmuokkaus.tyhjenna'| i18n}}"
            toggle-weeks-text="{{'Organisaationmuokkaus.viikkonumerot'| i18n}}" />
    <div>
        <span ng-show="!model.isAcceptable" class="text-error">Luontipäivämäärä on pakollinen tieto.</span>
        <div class="infotext">
            <div>&nbsp;</div>
            <!-- TODO: translateable -->
            <div ng-show="model.muokkauksenTila === model.Tila.MUOKKAAMATON">Muutettuasi organisaation voimassaoloa voit valita aliorganisaatiot, joiden voimassaoloa muutetaan samalla.
            <div>&nbsp;</div>Organisaation aliorganisaatiot:</div>
            <div ng-show="model.muokkauksenTila === model.Tila.ALKU_PVM_POISTETTU">
            <div>&nbsp;</div>Organisaation aliorganisaatiot:</div>
            <div ng-show="model.muokkauksenTila === model.Tila.ALKU_PVM_ASETETTU">Olet merkinnyt organisaation {{model.organisaationNimi}} voimassaolon alkupäivämääräksi {{model.alkuPvm| date:'d.M.yyyy'}}.
            <div>&nbsp;</div>Myös merkityille aliorganisaatioille asetetaan voimassaolon alkupäivämääräksi {{model.alkuPvm| date:'d.M.yyyy'}}:</div>
            <div ng-show="model.muokkauksenTila === model.Tila.ALKU_PVM_SUUNNITELTU">Olet merkinnyt organisaation {{model.organisaationNimi}} voimassaolon suunnitelluksi alkupäivämääräksi {{model.alkuPvm| date:'d.M.yyyy'}}.
            <div>&nbsp;</div>Myös merkityille aliorganisaatioille asetetaan suunniteltu voimassaolon alkupäivämäärä {{model.alkuPvm| date:'d.M.yyyy'}}:</div>
            <div ng-show="model.muokkauksenTila === model.Tila.LAKKAUTUS_PVM_POISTETTU">Organisaation {{model.organisaationNimi}} viimeinen voimassaolopäivä on tyhjennetty. Organisaation ja sen valittujen aliorganisaatioiden lakkauttaminen perutaan.
            <div>&nbsp;</div>Merkittyjen aliorganisaatioiden lakkauttaminen perutaan:</div>
            <div ng-show="model.muokkauksenTila === model.Tila.LAKKAUTUS_PVM_ASETETTU">Olet merkinnyt organisaation {{model.organisaationNimi}} viimeiseksi voimassaolopäiväksi {{model.lakkautusPvm| date:'d.M.yyyy'}}. Organisaation lakkauttamisen yhteydessä myös valitut aliorganisaatiot lakkautetaan.
            <div>&nbsp;</div>Merkityt aliorganisaatiot lakkautetaan {{model.lakkautusPvm| date:'d.M.yyyy'}}:</div>
            <div ng-show="model.muokkauksenTila === model.Tila.LAKKAUTUS_PVM_SUUNNITELTU">Olet merkinnyt organisaation {{model.organisaationNimi}} suunnitelluksi viimeiseksi voimassaolopäiväksi {{model.lakkautusPvm| date:'d.M.yyyy'}}. Organisaation lakkauttamisen yhteydessä myös valitut aliorganisaatiot tullaan lakkauttamaan.
            <div>&nbsp;</div>Merkityt aliorganisaatiot tullaan lakkauttamaan {{model.lakkautusPvm| date:'d.M.yyyy'}}:</div>
            <div ng-show="model.muokkauksenTila === model.Tila.LAKKAUTUS_PVM_JATKETTU">Olet jatkanut organisaation {{model.organisaationNimi}} voimassaoloaikaa. Organisaatio palautetaan aktiiviseksi.
            <div>&nbsp;</div>Myös merkityt aliorganisaatiot palautetaan aktiiviseksi:</div>
        </div>
        <div class="well">
            <ol class="unstyled" ng-show="model.aliorganisaatioTree.length">
                <li ng-repeat="data in model.aliorganisaatioTree | orderBy:'nimi'"
                    ng-include="'aliorganisaatio_node.html'">
                </li>
            </ol>
            <div ng-hide="model.aliorganisaatioTree.length">{{'Organisaatiot.loading' |i18n}}</div>
        </div>
    </div>
</div>



<div class="modal-footer">
    <div class="form-fluid">
        <!--        <button class="btn" ng-click="$dismiss()">{{'Organisaationmuokkaus.peruuta' | i18n}}</button>
                <button class="btn" ng-click="$close()">{{'Organisaationmuokkaus.hyvaksy' | i18n}}</button>-->
        <button class="btn" ng-click="cancel()">{{'Organisaationmuokkaus.peruuta' | i18n}}</button>
        <button ng-disabled="!model.isDirty || !model.isAcceptable" class="btn" ng-click="accept()">{{'Organisaationmuokkaus.hyvaksy' | i18n}}</button>
    </div>
</div>


